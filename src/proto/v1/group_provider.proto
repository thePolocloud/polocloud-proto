syntax = "proto3";

package dev.httpmarco.polocloud.v1.proto;

option java_package = "dev.httpmarco.polocloud.v1.groups";
option java_multiple_files = true;

import "v1/template_provider.proto";

import "google/protobuf/timestamp.proto";
import "google/protobuf/struct.proto";

service GroupController {
  rpc find(FindGroupRequest) returns (FindGroupResponse);
  rpc create(GroupSnapshot) returns (GroupSnapshot);
  rpc update(GroupSnapshot) returns (GroupSnapshot);
  rpc delete(GroupDeleteRequest) returns (DeleteGroupResponse);
}

message GroupSnapshot {
  string name = 1;
  GroupType type = 2;
  GroupPlatformSnapshot platform = 3;
  int32 min_memory = 4;
  int32 max_memory = 5;
  int32 min_online = 6;
  int32 max_online = 7;
  double start_threshold = 8;
  google.protobuf.Timestamp created_at = 9;
  repeated TemplateSnapshot templates = 10;
  map<string, string> properties = 11;
}

message FindGroupRequest {
  optional string name = 1;
  optional GroupType type = 2;
}

message DeleteGroupResponse {
  bool deleted = 1;
}

message FindGroupResponse {
  repeated GroupSnapshot groups = 1;
}

message GroupDeleteRequest {
  string name = 1;
}

message GroupInformationSnapshot {
  google.protobuf.Timestamp created_at = 1;
}

message GroupPlatformSnapshot {
  string name = 2;
  string version = 1;
}

enum GroupType {
  SERVICE = 0;
  SERVER = 1;
  PROXY = 2;
}